\documentclass[11pt]{article}

% -------------------------------------------------
% Layout and typography
% -------------------------------------------------
\usepackage[a4paper,margin=1in]{geometry}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{microtype}

% Widow / orphan control
\widowpenalty=10000
\clubpenalty=10000
\displaywidowpenalty=10000

% -------------------------------------------------
% Tables and formatting
% -------------------------------------------------
\usepackage{booktabs}
\usepackage{array}
\usepackage{longtable}
\usepackage{ltablex} % long tables with page breaks
\keepXColumns
\usepackage{etoolbox}
\AtBeginEnvironment{longtable}{\setlength{\LTpre}{0pt}\setlength{\LTpost}{0pt}}
\setlength{\parskip}{0.5em}

% -------------------------------------------------
% Code blocks
% -------------------------------------------------
\usepackage{listings}
\usepackage{xcolor}
\lstset{
  basicstyle=\ttfamily\small,
  columns=fullflexible,
  keepspaces=true,
  frame=single,
  backgroundcolor=\color{gray!10},
  breaklines=true,
  xleftmargin=0.5em,
  xrightmargin=0.5em
}

% -------------------------------------------------
% Hyperlinks
% -------------------------------------------------
\usepackage[hidelinks]{hyperref}

% -------------------------------------------------
% Strikeout for TODOs
% -------------------------------------------------
\usepackage[normalem]{ulem}

% -------------------------------------------------
% Prevent page breaks mid minipages
% -------------------------------------------------
\usepackage{needspace}

% -------------------------------------------------
% Title page
% -------------------------------------------------
\usepackage{titling}

\title{\LARGE CPU Architecture Documentation}
\author{\href{https://github.com/omar-elsherbiny}{sherbodev}}
\date{January 17, 2026}

% -------------------------------------------------
% Document
% -------------------------------------------------
\begin{document}

% -----------------------
% Title page
% -----------------------
\begin{titlepage}
    \centering
    \vspace*{3cm}
    {\Huge \bfseries CPU Architecture Documentation \par}
    \vspace{2cm}
    {\large Made by: \href{https://github.com/omar-elsherbiny}{sherbodev} \par}
    {\large Date: January 17, 2026 \par}
    \vspace{1cm}
    {\small Credits: Inspired by Sebastian Lague's Digital Logic Simulator \par}
    \vfill
\end{titlepage}

% -----------------------
% Table of Contents
% -----------------------
\clearpage
\tableofcontents
\thispagestyle{empty}
\clearpage

% =================================================
\section{Structure}
\label{sec:structure}

\subsection{Registers}

\begin{longtable}{>{\centering}m{3cm} >{\centering}m{3cm} >{\centering\arraybackslash}m{5cm}}
\toprule
\textbf{Register} & \textbf{Size (bits)} & \textbf{Name} \\
\midrule
\endfirsthead
\toprule
\textbf{Register} & \textbf{Size (bits)} & \textbf{Name} \\
\midrule
\endhead
\bottomrule
\endfoot
PC & 8 & Program Counter \\
CIR\_Opcode & 4 & Current Instruction Register \\
CIR\_Operand & 8 & Current Instruction Register \\
MAR & 8 & Memory Address Register \\
MDR & 8 & Memory Data Register \\
ACC & 8 & Accumulator \\
FLAG & 4 & G, E \\
RAM\_Opcode & 256$\times$4 & Random Access Memory \\
RAM\_Operand & 256$\times$8 & Random Access Memory \\
\end{longtable}

\noindent
\emph{RAM is split into: \textbf{224$\times$12 ROM} + \textbf{32$\times$12 RAM}}

\subsection{Operations}

\begin{longtable}{>{\centering}m{3cm} >{\centering}m{3cm} >{\centering\arraybackslash}m{6cm}}
\toprule
\textbf{Mnemonic} & \textbf{Opcode} & \textbf{Details} \\
\midrule
\endfirsthead
\toprule
\textbf{Mnemonic} & \textbf{Opcode} & \textbf{Details} \\
\midrule
\endhead
\bottomrule
\endfoot
NOP & 0 & No Operation \\
LDA & 1 & Load RAM $\rightarrow$ ACC \\
LDI & 2 & Load Immediate $\rightarrow$ ACC \\
STA & 3 & Store ACC $\rightarrow$ RAM \\
JMP & 4 & Jump Unconditionally \\
JEQ & 5 & Jump if E FLAG \\
JGT & 6 & Jump if G FLAG \\
CMP & 7 & Set FLAG \\
ADD & 8 & Add ACC += RAM \\
ADI & 9 & Add ACC += Immediate \\
SUB & 10 & Sub ACC -= RAM \\
SBI & 11 & Sub ACC -= Immediate \\
SHF & 12 & Shift ACC $\ll=$ RAM \\
AND & 13 & And ACC \&= RAM \\
ORR & 14 & Or ACC |= RAM \\
XOR & 15 & Xor ACC $\oplus=$ RAM \\
\end{longtable}

\clearpage

% =================================================
\section{Fetch}
\label{sec:fetch}

\begin{lstlisting}
MAR <- PC
CIR_Opcode <- RAM[MAR]_Opcode
CIR_Operand <- RAM[MAR]_Operand
PC <- PC + 1
\end{lstlisting}

% =================================================
\section{Decode}
\label{sec:decode}
\noindent
Opcode -> 4 bits \\
Operand -> 8 bits (Data/Address)

\subsubsection*{Special Cases}

\noindent
\texttt{0} -> NOP \\
\texttt{3} -> STA
\begin{lstlisting}
MAR <- CIR_Operand
\end{lstlisting}

\texttt{4,5,6} -> jumps
\begin{lstlisting}
MDR <- CIR_Operand
\end{lstlisting}

\subsubsection*{ACC/FLAGS <- x}

\texttt{1,7,8,10,12,13,14,15} (fetch address)
\begin{lstlisting}
MAR <- CIR_Operand
MDR <- RAM[MAR]_Operand
\end{lstlisting}

\texttt{2,9,11} (Immediate)
\begin{lstlisting}
MDR <- CIR_Operand
\end{lstlisting}

% =================================================
\section{Execute}
\label{sec:execute}

\begin{minipage}[t]{0.48\linewidth}
\subsubsection*{0 -- NOP}
\begin{lstlisting}
-- No Operation --
\end{lstlisting}

\subsubsection*{1 -- LDA}
\begin{lstlisting}
MAR <- CIR_Operand
MDR <- RAM[MAR]_Operand
ACC <- MDR
\end{lstlisting}

\subsubsection*{2 -- LDI}
\begin{lstlisting}
MDR <- CIR_Operand
ACC <- MDR
\end{lstlisting}

\subsubsection*{3 -- STA}
\begin{lstlisting}
MAR <- CIR_Operand
RAM[MAR]_Operand <- ACC
\end{lstlisting}

\subsubsection*{4 -- JMP}
\begin{lstlisting}
MDR <- CIR_Operand
PC <- MDR
\end{lstlisting}

\subsubsection*{5 -- JEQ}
\begin{lstlisting}
MDR <- CIR_Operand
if E:
    PC <- MDR
\end{lstlisting}

\subsubsection*{6 -- JGT}
\begin{lstlisting}
MDR <- CIR_Operand
if G:
    PC <- MDR
\end{lstlisting}

\subsubsection*{7 -- CMP}
\begin{lstlisting}
MAR <- CIR_Operand
MDR <- RAM[MAR]_Operand
FLAG <- compare(ACC, MDR)
\end{lstlisting}

\end{minipage}
\hfill
\begin{minipage}[t]{0.48\linewidth}
\subsubsection*{8 -- ADD}
\begin{lstlisting}
MAR <- CIR_Operand
MDR <- RAM[MAR]_Operand
ACC <- ACC + MDR
\end{lstlisting}

\subsubsection*{9 -- ADI}
\begin{lstlisting}
MDR <- CIR_Operand
ACC <- ACC + MDR
\end{lstlisting}

\subsubsection*{10 -- SUB}
\begin{lstlisting}
MAR <- CIR_Operand
MDR <- RAM[MAR]_Operand
ACC <- ACC - MDR
\end{lstlisting}

\subsubsection*{11 -- SBI}
\begin{lstlisting}
MDR <- CIR_Operand
ACC <- ACC - MDR
\end{lstlisting}

\subsubsection*{12 -- SHF}
\begin{lstlisting}
MAR <- CIR_Operand
MDR <- RAM[MAR]_Operand
ACC <- ACC << MDR
\end{lstlisting}

\subsubsection*{13 -- AND}
\begin{lstlisting}
MAR <- CIR_Operand
MDR <- RAM[MAR]_Operand
ACC <- ACC & MDR
\end{lstlisting}

\subsubsection*{14 -- ORR}
\begin{lstlisting}
MAR <- CIR_Operand
MDR <- RAM[MAR]_Operand
ACC <- ACC | MDR
\end{lstlisting}

\subsubsection*{15 -- XOR}
\begin{lstlisting}
MAR <- CIR_Operand
MDR <- RAM[MAR]_Operand
ACC <- ACC ^ MDR
\end{lstlisting}
\end{minipage}

% =================================================
\section{Connections}
\label{sec:connections}

\begin{minipage}[t]{0.48\linewidth}
\subsubsection*{PC}
\begin{lstlisting}
ALU 1-> | PC | *-> MAR
\end{lstlisting}

\subsubsection*{CIR}
\begin{lstlisting}
RAM 1-> | CIR_Operand | /2-> MAR
        |             | \3-> MDR
\end{lstlisting}

\subsubsection*{MAR}
\begin{lstlisting}
PC 1->\ | MAR | *-> RAM[]
CIR 2->/
\end{lstlisting}
\end{minipage}
\hfill
\begin{minipage}[t]{0.48\linewidth}
\subsubsection*{MDR}
\begin{lstlisting}
CIR 1->\ | MDR | 3-> ALU
RAM 2->/
\end{lstlisting}

\subsubsection*{ACC}
\begin{lstlisting}
ALU 1-> | ACC | 2-> MDR
\end{lstlisting}

\subsubsection*{FLAG}
\begin{lstlisting}
ALU 1*-> | FLAG | 2*-> ALU
\end{lstlisting}

\subsubsection*{RAM}
\begin{lstlisting}
ALU 1-> | RAM | /2-> CIR
MAR *-> |     | \3-> MDR
\end{lstlisting}
\end{minipage}

% =================================================
\section{Cycle}
\label{sec:cycle}

\begin{lstlisting}
10 tick cycle:
4 - FETCH
4/2 - DECODE
2 - EXECUTE
\end{lstlisting}

% =================================================
\section{Buses}
\label{sec:buses}

\begin{lstlisting}
store MAR
pulse MAR

store MDR
pulse MDR

pulse EXECUTE
\end{lstlisting}

\end{document}
